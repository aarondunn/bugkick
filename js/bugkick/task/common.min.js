/**
* Bugkick MicroTasks
* Author: Alexey Kavshirko kavshirko@gmail.com
* Date: 18.03.13
* Time: 23:04
*/
jQuery("a.add-task").live("click",function(){$.post($(this).attr("href"),{YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(a){jQuery("#createTaskForm").html(a);jQuery("#TaskForm_description").keypress(function(b){if(b.which==13){createTask();return false}});jQuery("#createTaskDialog").dialog("open")},"html");return false});createTask=function(){$.jGrowl.defaults.position="bottom-right";$.jGrowl.defaults.life=2000;$("#task-form").ajaxSubmit({success:function(a){$("#createTaskDialog").dialog("close");if($.fn.yiiListView&&!!$("#task-list").length){$.fn.yiiListView.update("task-list")}$.jGrowl("Task is created.")},error:function(a){$.jGrowl("Please check the fields.")},dataType:"json"});return false};$(".task-item input[type=checkbox]").live("click",function(c){$.jGrowl.defaults.life=2000;var b=$(this);var a=$(this).parent().attr("taskID");$.ajax({url:"/task/complete",type:"post",data:{YII_CSRF_TOKEN:YII_CSRF_TOKEN,taskID:a},success:function(e){var d=b.next(".task-description");if(d.hasClass("crossed")){d.removeClass("crossed")}else{d.addClass("crossed")}$.jGrowl("Saved")},error:function(d){if($.fn.yiiListView&&!!$("#task-list").length){$.fn.yiiListView.update("task-list")}$.jGrowl("Error. Please try again later")},dataType:"html"})});function saveTask(b,a){$.jGrowl.defaults.life=2000;var c=b.attr("taskID");$.ajax({url:"/task/edit",type:"post",data:{YII_CSRF_TOKEN:YII_CSRF_TOKEN,taskID:c,description:$(textbox).val()},success:function(d){a();$.jGrowl("Saved")},error:function(d){$.jGrowl("Error. Please try again later")},dataType:"html"})}$(".edit_task_button").live("click",function(){var a=$(this).parent().parent();var b=$(a.children("span")[0]);if(a.attr("editing")){a.attr("editing",null);saveTask(a,function(){$(b).html(textbox.val());a.attr("editing",null)})}else{a.attr("editing",true);textbox=$("<input type='text'></input>");$(textbox).val(b.html().trim());$(b).html($(textbox));$(textbox).keyup(function(c){if(c.keyCode==13){saveTask(a,function(){$(textbox).replaceWith($(textbox).val());a.attr("editing",null)})}})}});