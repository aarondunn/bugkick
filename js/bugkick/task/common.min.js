/**
 * Bugkick MicroTasks
 * Author: Alexey Kavshirko kavshirko@gmail.com
 * Date: 18.03.13
 * Time: 23:04
 */

function saveTask(e,t){$.jGrowl.defaults.life=2e3;var n=e.attr("taskID");$.ajax({url:"/task/edit",type:"post",data:{YII_CSRF_TOKEN:YII_CSRF_TOKEN,taskID:n,description:$(textbox).val()},success:function(e){t();$.jGrowl("Saved")},error:function(e){$.jGrowl("Error. Please try again later")},dataType:"html"})}jQuery("a.add-task").live("click",function(){$.post($(this).attr("href"),{YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(e){jQuery("#createTaskForm").html(e);jQuery("#createTaskDialog").dialog("open")},"html");return false});createTask=function(){$.jGrowl.defaults.position="bottom-right";$.jGrowl.defaults.life=2e3;$("#task-form").ajaxSubmit({success:function(e){$("#createTaskDialog").dialog("close");if($.fn.yiiListView&&!!$("#task-list").length){$.fn.yiiListView.update("task-list")}$.jGrowl("Task is created.")},error:function(e){$.jGrowl("Please check the fields.")},dataType:"json"});return false};$(".task-item input[type=checkbox]").live("click",function(e){$.jGrowl.defaults.life=2e3;var t=$(this);var n=$(this).parent().attr("taskID");$.ajax({url:"/task/complete",type:"post",data:{YII_CSRF_TOKEN:YII_CSRF_TOKEN,taskID:n},success:function(e){var n=t.next(".task-description");if(n.hasClass("crossed"))n.removeClass("crossed");else n.addClass("crossed");$.jGrowl("Saved")},error:function(e){if($.fn.yiiListView&&!!$("#task-list").length){$.fn.yiiListView.update("task-list")}$.jGrowl("Error. Please try again later")},dataType:"html"})});$(".edit_task_button").click(function(){var e=$(this).parent().parent();var t=$(e.children("span")[0]);if(e.attr("editing")){e.attr("editing",null);saveTask(e,function(){$(t).html(textbox.val());e.attr("editing",null)})}else{e.attr("editing",true);textbox=$("<input type='text'></input>");$(textbox).val(t.html().trim());$(t).html($(textbox));$(textbox).keyup(function(t){if(t.keyCode==13){saveTask(e,function(){$(textbox).replaceWith($(textbox).val());e.attr("editing",null)})}})}})